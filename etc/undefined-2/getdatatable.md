---
description: >-
  פונקציה אסינכרונית לבצע פרוצדורה שמורה מהמסד נתונים בצד לקוח ולקבל חזרה טבלה
  בצורה של מערך של אובייקטים
---

# getDatatable

נקח לצורך הדוגמה את הפרוצדורה הבאה:

```
create proc PR_GetAllDayHours
@date date
as
    select '00:00' as Hour, @date as Date
    union select '01:00', @date as Date
    union select '02:00', @date as Date
    ...
    union select '23:00', @date as Date
```

&#x20;במידה ונריץ את הפרוצדורה הנ"ל, נקבל את הטבלה הבאה:

```
+-------+------------+
| Hour  |    Date    |
+-------+------------+
| 00:00 | 2022-22-03 |
| 01:00 | 2022-22-03 |
| 02:00 | 2022-22-03 |
| 03:00 | 2022-22-03 |
| ...   | ...        |
| 23:00 | 2022-22-03 |
+-------+------------+
```

אנחנו יכולים לקבל את הטבלה הזו ישירות מהדפדפן בתור אובייקט ג'אווהסקריפט אותנטי כזה:

```
[
    {Hour: '00:00', Date: '2022-22-03'},
    {Hour: '01:00', Date: '2022-22-03'},
    {Hour: '02:00', Date: '2022-22-03'},
    ...
    {Hour: '23:00', Date: '2022-22-03'},
]
```

וזאת ע"י קריאה לפונקציה getDatatable, הנה דוגמה:

```
var table = await getDatatable({
    sp: 'PR_GetAllDayHours', 
    params: {
        date: '2022-22-03'
    }
});
console.log(JSON.stringify(table[0])) // {"Hour": "00:00", "Date": "2022-22-03"}
```

להלן הפרמטרים שהפונקציה יכולה לקבל:

* `sp` - שם הפרוצדורה
* `params` - אובייקט המכיל את הפרמטרים לשליחה וערכיהם
* `success` - פונקציה שתרוץ בעת ביצוע מוצלח של השאילתא
* `error` - פונקציה שתרוץ בעת ביצוע כושל של השאילתא
* `addUser` - האם להוסיף את מזהה המשתמש המחובר בתור הפרמטר לפרוצדורה (@UserID int)
* `addLocation` - האם להוסיף את מזהה הסניף\מרפאה אליה מחובר המשתמש בתור הפרמטר לפרוצדורה (@LocationID int)
* `async` - פרמטר בוליאני, במידה והוא אמת, הפרוצדורה תרוץ בצורה אסינכרונית, אחרת הפעולה תתבצע בצורה סינכרונית, ועד לקבלת תשובה מהשרת המסך יהיה קפוא (לא מומלץ, ברירת המחדל היא אסינכרונית)

במידה והפונקציה רצה בצורה אסינכרונית, חוזר מהפרוצדורה אובייקט פרומיס (אובייקט שמבצע פעולה ברקע, ומודיע בעת שהוא מסיים את הפעולה, אם בהצלחה ואם בכישלון)

מידע נוסף על פרומיסים וכיצד לעבוד איתם ניתן למצוא כאן:

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using\_promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using\_promises)
